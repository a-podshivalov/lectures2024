# Практическое занятие 2: процессы, межпроцессное взаимодействие, драйверы, интерфейсы внешних устройста

## Необходимая документация

Управление процессами в RIOT описано в документации ОС:

https://doc.riot-os.org/group__core.html

Для работы с внешними устройствами можно использовать имеющиеся в комплекте оборудования модули с датчиками освещенности OPT3001 (UMDK-LIT), температуры-влажности-давления BME280 (UMDK-THP), акселерометром/гироскопом LSM6DS3 (UMDK-ACC). Все они подключены по интерфейсу I2C, примеры работы с этими датчиками есть на Github (`examples-miem/sensors`).

7 задание из предыдущего набора все еще принимается.

## Задания

1. (1) Продемонстрируйте в RIOT инверсию приоритетов (в том числе с участием "среднеприоритетного" процесса, не конкурирующего за ресурс - посмотрите в качестве примера `tests/thread_priority_inversion`) и взаимоблокировку потоков. Включите опцию "наследования приоритета" при захвате mutex-а, убедитесь, что она работает. Какие недостатки имеет это решение?

2. (1) Подключите одновременно датчики температуры-влажности-давления BME280 и DHT11, сравните их показания.

3. (1) Реализуйте датчик удара/перемещения с использованием акселерометра (например, при ударе или перемещении устройства зажигайте светодиод).

4. (1) Включите в приложение модуль shell (`sys/shell`), добавьте несколько собственных команд, например, для получения данных от датчиков.

5. (2) Выведите адреса (можно ограничиться 7-битными) всех устройств, подключенных по шине I2C.

6. (2) Добавьте опрос нескольких датчиков, получение данных от них, управление GPIO и тому подобное - на ваш выбор - по протоколу Modbus RTU, используя штатный ("консольный") UART. Для проверки работы Modbus будет использоваться программа Termite: http://s2-team.ru/termite-quick-start-guide/

7. (2) Используя рекомендации фирмы Maxim (https://www.maximintegrated.com/en/design/technical-documents/tutorials/2/214.html) и драйвер 1-wire (`drivers/onewire`), подключите к микроконтроллеру устройство с интерфейсом 1-Wire (например, "домофонный" ключ).

8. (2) Ночник: с помощью ШИМ регулируйте яркость светодиода в зависимости от показаний датчика освещенности.

9. (2) Кодовый замок-2: Добавьте к кодовому замку из первого набора заданий модуль чтения бесконтактных карт (он прекрасно работает с "Тройкой", читая ее идентификатор). Картам "авторизованных" пользователей должны соответствовать пароли (храните их в программе

10. (2-4) Добавьте драйвер любого внешнего устройства, которого еще нет в RIOT.

11. (3) С помощью bit-banging реализуйте однопроводную "шину" для связи между несколькими устройствами. Можно использовать, например, UART-подобный протокол, для подключения нескольких устройств используйте выход с открытым коллектором. (2) Оформите программный интерфейс `netif` для этой шины.